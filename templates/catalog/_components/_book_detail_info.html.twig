<div class="book-info-section fade-in">

    <div class="book-badges">
        {% if book.categoria %}
            <span class="badge badge-custom bg-primary">
                <i class="bi bi-tag-fill"></i> {{ book.categoria }}
            </span>
        {% endif %}

        {% if book.editorial %}
            <span class="badge badge-custom bg-secondary">
                <i class="bi bi-building"></i> {{ book.editorial }}
            </span>
        {% endif %}

        {% if book.idioma %}
            <span class="badge badge-custom bg-info">
                <i class="bi bi-globe"></i> {{ book.idioma|upper }}
            </span>
        {% endif %}
    </div>

    <h1 class="book-title">{{ book.titulo }}</h1>

    <p class="book-author">
        <i class="bi bi-person-fill"></i> {{ book.autor }}
    </p>

    {% if book.rating %}
        <div class="book-rating">
            <span class="stars">
                {% for i in 1..5 %}
                    <i class="bi bi-star{% if i <= book.rating %}-fill{% endif %} text-warning"></i>
                {% endfor %}
            </span>
            <span class="rating-value">({{ book.rating|number_format(1) }})</span>
            {% if book.ratings_count %}
                <small class="text-muted">{{ book.ratings_count }} reseñas</small>
            {% endif %}
        </div>
    {% endif %}


    {% set prices = both_prices(book.precio, book.moneda) %}

    {% if prices.forSale %}
        {% include 'catalog/_components/_price_converter.html.twig' with {'prices': prices} %}

        {% if book.descripcion %}
            <div class="book-short-description mb-4">
                <p class="lead">
                    {{ book.descripcion|slice(0, 200) }}{% if book.descripcion|length > 200 %}...{% endif %}
                </p>
            </div>
        {% endif %}

        <div class="book-actions">
            <div class="quantity-selector">
                <button id="decrease-qty" class="btn btn-outline-secondary quantity-btn">
                    <i class="bi bi-dash"></i>
                </button>
                <input type="number" id="quantity" class="form-control quantity-input" value="1" min="1" max="10" readonly>
                <button id="increase-qty" class="btn btn-outline-secondary quantity-btn">
                    <i class="bi bi-plus"></i>
                </button>
            </div>

            <button id="add-to-cart-btn" class="btn btn-warning btn-lg flex-grow-1" data-isbn="{{ book.isbn }}">
                <i class="bi bi-cart-plus"></i> Añadir al carrito
            </button>

            <button class="btn btn-outline-danger btn-lg" title="Añadir a la lista de deseos">
                <i class="bi bi-heart"></i>
            </button>
        </div>

        <div class="alert alert-info mt-4">
            <i class="bi bi-truck"></i>
            <strong>Envío gratuito</strong> en pedidos superiores a 50 $
        </div>

    {% else %}
        <div class="not-for-sale-section">
            <div class="alert alert-warning" role="alert">
                <i class="bi bi-exclamation-triangle"></i>
                <strong>NOT FOR SALE</strong>
                <p class="mb-0">Este libro no está disponible para su compra en este momento</p>
            </div>
            <button class="btn btn-outline-secondary btn-lg w-100" disabled>
                <i class="bi bi-cart-x"></i> No disponible
            </button>
        </div>

        {% if book.descripcion %}
            <div class="book-short-description mb-4 mt-4">
                <p class="lead">
                    {{ book.descripcion|slice(0, 200) }}{% if book.descripcion|length > 200 %}...{% endif %}
                </p>
            </div>
        {% endif %}
    {% endif %}

</div>